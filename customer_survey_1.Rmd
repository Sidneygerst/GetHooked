---
title: "Customer Survey 1"
author: "Sidney Gerst, Corinna Hong"
date: "April 29, 2020"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(tidyverse)
library(paletteer)

```

This markdown will combine the two customer surveys and compare existing customer answers with new customer answers. 

```{r}

#load in the customer data
new_customers <- read_csv("new_customer_survey1.csv")
old_customers <- read_csv("existing_customer_survey1.csv")

#add new identifer column to both dataframes before combining
new_customer_id <- new_customers %>%
  mutate(id = "new")

old_customer_id <- old_customers %>%
  mutate(id = "existing") %>%
  select(-X46)

#combine the dfs
all_customers <- bind_rows(new_customer_id, old_customer_id) %>%
  select(-feedback, -name) #get rid of columns w NAs (feedback and names), we don't care

```

```{r}

# Visualize known csf
total_survey_counts <- all_customers %>% 
  select(id) %>%
  group_by(id) %>% 
  summarize(total = length(id)) # total number of surveys for existing and new

csf_known_df <- all_customers %>% 
  select(known_csf, id) %>% 
  group_by(known_csf, id) %>% 
  summarize(count = length(known_csf)) # number who responded yes/no in existing and new

proportion_csf <- csf_known_df %>% 
  left_join(total_survey_counts, by = "id") %>% 
  mutate(proportion = count/total)

csf_bar <- ggplot(proportion_csf, aes(x = known_csf, y = proportion, fill = id)) + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "CSF Knowledge", y = "Proportion") +
  scale_fill_discrete(name = "Customer Group",labels = c("Existing", "New")) +
  scale_y_continuous(expand = c(0,0)) +
  theme_classic()

csf_bar

```

```{r}

# Explore necessity between existing and new
necessary_df <- all_customers %>% 
  select(necessary_grocery, id) %>% 
  group_by(necessary_grocery, id) %>% 
  summarize(count = length(necessary_grocery)) # number who responded yes/sometimes/no in existing and new

proportion_necessary <- necessary_df %>% 
  left_join(total_survey_counts, by = "id") %>% 
  mutate(proportion = count/total)


necessary_bar <- ggplot(proportion_necessary, aes(x = necessary_grocery, y = proportion, fill = id)) + 
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_discrete(name = "Customer Group", labels = c("Existing", "New")) +
  labs(x = "Necessity", y = "Proportion") +
  scale_y_continuous(expand = c(0,0)) +
  theme_classic()

necessary_bar



# Explore necessity broken down by delivery counts
necessary_delivery_df <- all_customers %>% 
  select(necessary_grocery, delivery_count) %>% 
  group_by(necessary_grocery, delivery_count) %>% 
  summarize(necessary = length(necessary_grocery)) %>% # number of people who said yes/sometimes/no based on the # of deliveries they have received
  mutate(delivery_count = factor(delivery_count, levels = c("1-3", "4-6", "7-9","10 or more")))

proportion_necessary_delivery <- necessary_delivery_df %>% 
  mutate(proportion = necessary/324) # Divide by total # of surveys


necessary_delivery_bar <- ggplot(proportion_necessary_delivery, aes (x = delivery_count, y = proportion, fill = necessary_grocery)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Delivery Count", y = "Proportion") +
  scale_fill_manual(name = "Necessity", values = c("pink2", "grey89","darkslategray3")) + # change legend name and color
  theme_classic()
  

necessary_delivery_bar

```

```{r}

# Demographics
demo_df <- all_customers %>% 
  select(id, age, household_number,grocery_expenditure,income)



# Age pie chart
age_pie_df <- demo_df %>% 
  group_by(age) %>% 
  summarize(total = length(age)) %>% 
  mutate(proportion = total/324)

age_pie <- ggplot(age_pie_df, aes(x = "", y = total, fill = age)) +
  geom_bar(stat = "identity", width = 2, color = "grey80") +
  coord_polar("y", start = 0) + # turn this bar graph into a pie chart!
  theme_void() + # remove background, grid, and numberic labels
  scale_fill_paletteer_d("grDevices::blues9")

age_pie 



# Age proportions separated into new and existing
age_proportion_df <- demo_df %>% 
  group_by(age, id) %>% 
  summarize(count = length(age)) %>% 
  left_join(age_pie_df, by = "age") %>% 
  mutate(proportion = count/total) %>% 
  filter(age != "Rather not say") # remove those who declined to state

age_proportion_bar <- ggplot(age_proportion_df, aes(x = age, y = proportion, fill = id)) + 
  geom_bar(stat = "identity") +
  labs(x = "Age Range", y = "Proportion") +
  scale_fill_discrete(name = "Customer Group",labels = c("Existing", "New")) +
  scale_y_continuous(expand = c(0,0)) +
  theme_classic()

age_proportion_bar

```

